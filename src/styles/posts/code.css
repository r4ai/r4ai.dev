@layer base {
  div[data-rehype-pretty-code-fragment] {
    --code-block-bg-color: hsl(0, 0%, 98%);
    --highlighted-line-bg-color: theme(colors.neutral.500 / 10%);
    --highlighted-chars-bg-color: theme(colors.neutral.500 / 20%);
  }

  .dark div[data-rehype-pretty-code-fragment] {
    --code-block-bg-color: hsl(0, 0%, 8%);
    --highlighted-line-bg-color: theme(colors.neutral.600 / 25%);
    --highlighted-chars-bg-color: theme(colors.neutral.600 / 40%);
  }
}

@layer components {
  div[data-theme="light"],
  pre[data-theme="light"],
  code[data-theme="light"] {
    @apply dark:hidden;
  }

  div[data-theme="dark"],
  pre[data-theme="dark"],
  code[data-theme="dark"] {
    @apply hidden dark:inline-block;
  }

  code {
    @apply inline-block;
  }

  div[data-rehype-pretty-code-fragment] {
    & {
      background-color: var(--code-block-bg-color);
      @apply my-6 rounded-lg border px-0;
    }

    & > pre {
      background-color: transparent;
      @apply m-0 w-full overflow-auto rounded-t-none px-0;
    }

    & code {
      @apply grid text-[0.9rem];
    }

    & span[data-line] {
      @apply border-l-2 border-l-transparent px-4;
    }

    /* 行番号表示 */
    & code[data-line-numbers] {
      & {
        counter-reset: line;
      }

      & > span[data-line]::before {
        content: counter(line);
        counter-increment: line;
        @apply mr-3 inline-block w-4 text-right text-neutral-600;
      }
    }

    /* 行ハイライト */
    & span[data-highlighted-line] {
      background-color: var(--highlighted-line-bg-color);
      @apply border-l-blue-400;
    }

    /* 単語ハイライト */
    & span[data-highlighted-chars] {
      @apply rounded;
      background-color: var(--highlighted-chars-bg-color);
      box-shadow: 0 0 0px 4px var(--highlighted-chars-bg-color);
    }

    /* Code title */
    & > div[data-rehype-pretty-code-title] {
      @apply border-b px-4 py-3 font-mono text-sm text-foreground/80 md:text-base;
    }
  }
}
